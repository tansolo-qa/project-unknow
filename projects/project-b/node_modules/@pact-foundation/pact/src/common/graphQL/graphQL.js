"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.escapeGraphQlQuery = exports.escapeRegexChars = exports.escapeSpace = void 0;
exports.validateQuery = validateQuery;
var graphql_1 = require("graphql");
var graphql_tag_1 = __importDefault(require("graphql-tag"));
var graphQLQueryError_1 = require("./graphQLQueryError");
var configurationError_1 = require("./configurationError");
/**
 * Accepts a raw or pre-parsed query, validating in the former case, and
 * returns a normalized raw query.
 * @param query {string|ASTNode} the query to validate
 * @param type the operation type
 */
function validateQuery(query, type) {
    if (!query) {
        throw new configurationError_1.ConfigurationError("You must provide a GraphQL ".concat(type, "."));
    }
    if (typeof query !== 'string') {
        if ((query === null || query === void 0 ? void 0 : query.kind) === 'Document') {
            // Already parsed, store in string form
            return (0, graphql_1.print)(query);
        }
        throw new configurationError_1.ConfigurationError('You must provide a either a string or parsed GraphQL.');
    }
    else {
        // String, so validate it
        try {
            (0, graphql_tag_1.default)(query);
        }
        catch (e) {
            throw new graphQLQueryError_1.GraphQLQueryError("GraphQL ".concat(type, " is invalid: ").concat(e.message));
        }
        return query;
    }
}
var escapeSpace = function (s) { return s.replace(/\s+/g, '\\s*'); };
exports.escapeSpace = escapeSpace;
var escapeRegexChars = function (s) {
    return s.replace(/[-[\]/{}()*+?.\\^$|]/g, '\\$&');
};
exports.escapeRegexChars = escapeRegexChars;
var escapeGraphQlQuery = function (s) {
    return (0, exports.escapeSpace)((0, exports.escapeRegexChars)(s));
};
exports.escapeGraphQlQuery = escapeGraphQlQuery;
//# sourceMappingURL=graphQL.js.map